
## Organisation

L'ensemble du processus de pré-engagement se compose de trois éléments essentiels :

1. Scoping questionnaire
2. Réunion de pré-engagement
3. Réunion de lancement

Avant de pouvoir aborder ces points en détail, un `Non-Disclosure Agreement`( `NDA`) doit être signé par toutes les parties. Il existe plusieurs types d'accords de confidentialité :

|**Taper**|**Description**|
|---|---|
|`Unilateral NDA`|Ce type d'accord de confidentialité n'oblige qu'une seule partie à maintenir la confidentialité et autorise l'autre partie à partager les informations reçues avec des tiers.|
|`Bilateral NDA`|Dans ce type d'accord, les deux parties sont tenues de préserver la confidentialité des informations recueillies. Il s'agit du type d'accord de confidentialité le plus courant pour protéger le travail des testeurs d'intrusion.|
|`Multilateral NDA`|Un accord de confidentialité multilatéral (NDA) est un engagement de confidentialité pris par plus de deux parties. Si nous réalisons un test d'intrusion pour un réseau collaboratif, toutes les parties responsables et impliquées doivent signer ce document.|

Il est essentiel de déterminer dès le début du processus qui a le pouvoir de signature pour le contrat, les documents relatifs aux règles d'engagement, et qui seront les principaux et secondaires interlocuteurs, le support technique et les personnes à contacter pour la remontée des problèmes.

Cette étape requiert également la préparation de plusieurs documents préalables au test d'intrusion. Ces documents doivent être signés par notre client et par nous-mêmes afin que la déclaration de consentement puisse être présentée par écrit si nécessaire. À défaut, le test d'intrusion pourrait constituer une infraction à la [loi sur la cybercriminalité](https://www.legislation.gov.uk/ukpga/1990/18/contents) . Ces documents comprennent notamment :

|**Document**|**Le moment propice à la création**|
|---|---|
|`1. Non-Disclosure Agreement`( `NDA`)|`After`Contact initial|
|`2. Scoping Questionnaire`|`Before`la réunion de pré-engagement|
|`3. Scoping Document`|`During`la réunion de pré-engagement|
|`4. Penetration Testing Proposal`( `Contract/Scope of Work`( `SoW`))|`During`la réunion de pré-engagement|
|`5. Rules of Engagement`( `RoE`)|`Before`la réunion de lancement|
|`6. Contractors Agreement`(Évaluations physiques)|`Before`la réunion de lancement|
|`7. Reports`|`During` et `after`le test de pénétration effectué|

Remarque : Notre client peut fournir un document de cadrage distinct listant les adresses IP/plages/URL concernées et toutes les informations d'identification nécessaires, mais ces informations doivent également être documentées en annexe du document RoE.

**Remarque importante :**

Ces documents devraient être examinés et adaptés par un avocat après leur élaboration.

---

## [Scoping Questionnaire](https://academy.hackthebox.com/beta/module/90/section/937#scoping-questionnaire)

Après le premier contact avec le client, nous lui envoyons généralement un `Scoping Questionnaire`Afin de mieux comprendre les services qu'ils recherchent, ce questionnaire d'évaluation devrait clairement expliquer nos services et pourra généralement leur demander d'en choisir un ou plusieurs parmi la liste suivante :

|||
|---|---|
|☐ Évaluation de la vulnérabilité interne|☐ Évaluation de la vulnérabilité externe|
|☐ Test de pénétration interne|☐ Test de pénétration externe|
|☐ Évaluation de la sécurité sans fil|☐ Évaluation de la sécurité des applications|
|☐ Évaluation de la sécurité physique|☐ Évaluation de l'ingénierie sociale|
|☐ Évaluation de l'équipe rouge|☐ Évaluation de la sécurité des applications Web|

Pour chacune de ces questions, le questionnaire permettra au client de préciser l'évaluation requise. A-t-il besoin d'une évaluation d'application web ou mobile ? D'un audit de sécurité du code ? Le test d'intrusion interne doit-il être de type « boîte noire » et semi-évasif ? Souhaite-t-il uniquement une évaluation de phishing dans le cadre d'une évaluation d'ingénierie sociale, ou également une évaluation des appels vishing ? C'est l'occasion pour nous d'expliquer l'étendue de nos services, de nous assurer de bien comprendre les besoins et les attentes de notre client, et de garantir que nous sommes en mesure de réaliser l'évaluation adéquate.

Outre le type d'évaluation, le nom du client, son adresse et les coordonnées du personnel clé, voici quelques autres informations essentielles :

|||
|---|---|
|Combien d'animateurs en direct sont attendus ?||
|Combien d'adresses IP/plages CIDR sont concernées ?||
|Combien de domaines/sous-domaines sont concernés ?||
|Combien de SSID sans fil sont concernés ?||
|Combien d'applications web/mobiles ? Si les tests nécessitent une authentification, combien de rôles (utilisateur standard, administrateur, etc.) ?||
|Dans le cadre d'une évaluation de phishing, combien d'utilisateurs seront ciblés ? Le client fournira-t-il une liste ou devrons-nous la recueillir par le biais de renseignements en sources ouvertes (OSINT) ?||
|Si le client demande une évaluation physique, combien de sites sont concernés ? Si plusieurs sites sont inclus, sont-ils géographiquement dispersés ?||
|Quel est l’objectif de l’évaluation Red Team ? Certaines activités (comme le phishing ou les attaques physiques contre la sécurité) sont-elles exclues du périmètre ?||
|Une évaluation de sécurité Active Directory distincte est-elle souhaitée ?||
|Les tests réseau seront-ils effectués à partir d'un utilisateur anonyme du réseau ou d'un utilisateur de domaine standard ?||
|Faut-il contourner le contrôle d'accès au réseau (NAC) ?||

Enfin, nous souhaiterons vous interroger sur la divulgation d'informations et les comportements évasifs (le cas échéant, selon le type d'évaluation) :

- Le test d'intrusion est-il de type boîte noire (aucune information fournie), boîte grise (seules les adresses IP/plages CIDR/URL sont fournies) ou boîte blanche (informations détaillées fournies) ?
- Souhaiteraient-ils que nous effectuions des tests à partir d'une approche non évasive, hybride-évasive (commencer discrètement et augmenter progressivement le volume sonore pour évaluer à quel niveau le personnel de sécurité du client détecte nos activités), ou totalement évasive ?

Ces informations nous permettront d'affecter les ressources adéquates et de réaliser la prestation conformément aux attentes du client. Elles sont également indispensables pour établir une proposition précise, incluant un calendrier de projet (par exemple, une évaluation de vulnérabilité sera nettement plus rapide qu'une évaluation par équipe rouge) et un coût (un test d'intrusion externe ciblant 10 adresses IP coûtera beaucoup moins cher qu'un test d'intrusion interne portant sur 30 réseaux sur 24).

À partir des informations recueillies grâce au questionnaire exploratoire, nous établissons une vue d'ensemble et résumons toutes les informations dans le `Scoping Document`.

---

## [Réunion de pré-engagement](https://academy.hackthebox.com/beta/module/90/section/937#pre-engagement-meeting)

Une fois que nous avons une idée initiale des exigences du projet du client, nous pouvons passer à la suite. `pre-engagement meeting`Cette réunion permet d'aborder avec le client tous les éléments pertinents et essentiels avant le test d'intrusion, en les lui expliquant. Les informations recueillies durant cette phase, ainsi que les données issues du questionnaire de cadrage, serviront de base au test d'intrusion. `Penetration Testing Proposal`, également connu sous le nom de `Contract` ou `Scope of Work`( `SoW`On peut comparer l'ensemble du processus à une consultation médicale pour s'informer sur les examens prévus. Cette phase se déroule généralement par courriel et lors d'une visioconférence ou d'une rencontre en personne.

Remarque : Il arrive que certains clients réalisent leur tout premier test d’intrusion, ou que leur interlocuteur direct ne soit pas familiarisé avec le processus. Nous consacrons généralement une partie de la réunion de pré-engagement à examiner le questionnaire de cadrage, partiellement ou en détail.

#### [Contrat - Liste de vérification](https://academy.hackthebox.com/beta/module/90/section/937#contract-checklist)

|**Point de contrôle**|**Description**|
|---|---|
|`☐ NDA`|Un accord de confidentialité (NDA) est un contrat de secret professionnel conclu entre le client et le prestataire concernant toutes les informations écrites ou verbales relatives à une commande ou un projet. Le prestataire s'engage à traiter comme strictement confidentielles toutes les informations qui lui sont communiquées, même après la finalisation de la commande ou du projet. De plus, toute exception à la confidentialité, la cessibilité des droits et obligations, ainsi que les pénalités contractuelles doivent être stipulées dans l'accord. L'accord de confidentialité doit être signé avant la réunion de lancement ou, au plus tard, pendant cette réunion, avant toute discussion détaillée.|
|`☐ Goals`|Les objectifs sont des étapes clés à franchir au cours d'une commande ou d'un projet. Dans ce processus, la définition des objectifs commence par les objectifs principaux et se poursuit par des objectifs plus précis et de moindre envergure.|
|`☐ Scope`|Les différents éléments à tester sont définis et analysés. Il peut s'agir de domaines, de plages d'adresses IP, d'hôtes individuels, de comptes spécifiques, de systèmes de sécurité, etc. Nos clients peuvent s'attendre à ce que nous identifiions certains points par nous-mêmes. Toutefois, le respect du cadre légal pour le test de ces éléments est notre priorité absolue.|
|`☐ Penetration Testing Type`|Lors du choix du type de test d'intrusion, nous présentons les différentes options et expliquons leurs avantages et inconvénients. Connaissant déjà les objectifs et le périmètre de nos clients, nous pouvons et devons formuler une recommandation et la justifier. Le choix final du type de test revient au client.|
|`☐ Methodologies`|Exemples : OSSTMM, OWASP, analyse automatisée et manuelle non authentifiée des composants du réseau interne et externe, évaluations de la vulnérabilité des composants du réseau et des applications Web, vectorisation, vérification et exploitation des menaces de vulnérabilité, et développement d'exploits pour faciliter les techniques d'évasion.|
|`☐ Penetration Testing Locations`|Externe : Accès distant (via VPN sécurisé) et/ou Interne : Accès interne ou distant (via VPN sécurisé)|
|`☐ Time Estimation`|Pour estimer la durée du test d'intrusion, nous avons besoin de ses dates de début et de fin. Cela nous permet de définir une plage horaire précise et de planifier notre procédure. Il est également essentiel de déterminer explicitement la durée de chaque phase de l'attaque : exploitation, post-exploitation et déplacement latéral. Ces phases peuvent être réalisées pendant ou en dehors des heures ouvrables. En dehors de ces heures, l'accent est mis sur la robustesse des solutions et systèmes de sécurité qui doivent résister à nos attaques.|
|`☐ Third Parties`|Concernant les tiers, il convient de déterminer par quels fournisseurs notre client obtient ses services. Il peut s'agir de fournisseurs de services cloud, de fournisseurs d'accès à Internet ou d'autres hébergeurs. Notre client doit obtenir l'accord écrit de ces fournisseurs, attestant qu'ils acceptent et sont conscients que certaines parties de leurs services seront soumises à une simulation de piratage. Il est également fortement conseillé d'exiger du prestataire qu'il nous transmette l'autorisation du tiers afin que nous puissions confirmer son obtention.|
|`☐ Evasive Testing`|Les tests d'intrusion consistent à tester la capacité à contourner et à franchir les systèmes de sécurité de l'infrastructure du client. Nous recherchons des techniques permettant de recueillir des informations sur les composants internes et de les attaquer. Le recours à ces techniques dépend des directives de notre prestataire.|
|`☐ Risks`|Nous devons également informer notre client des risques liés aux tests et de leurs conséquences possibles. En fonction de ces risques et de leur gravité potentielle, nous pouvons ensuite définir ensemble les limites et prendre certaines précautions.|
|`☐ Scope Limitations & Restrictions`|Il est également essentiel de déterminer quels serveurs, postes de travail ou autres composants réseau sont indispensables au bon fonctionnement du client et de ses propres clients. Nous devons les éviter et ne pas intervenir davantage sur eux, car cela pourrait entraîner des erreurs techniques critiques susceptibles d'affecter les clients de notre client en production.|
|`☐ Information Handling`|HIPAA, PCI, HITRUST, FISMA/NIST, etc.|
|`☐ Contact Information`|Concernant les informations de contact, nous devons créer une liste comprenant le nom, le titre, la fonction, l'adresse électronique, le numéro de téléphone, le numéro de téléphone professionnel et un ordre de priorité d'escalade pour chaque personne.|
|`☐ Lines of Communication`|Il convient également de documenter les canaux de communication utilisés pour l'échange d'informations entre le client et nous. Il peut s'agir de correspondances par courriel, d'appels téléphoniques ou de rencontres en personne.|
|`☐ Reporting`|Outre la structure du rapport, nous abordons également les exigences spécifiques du client quant à son contenu. De plus, nous précisons les modalités de production du rapport et si une présentation des résultats est souhaitée.|
|`☐ Payment Terms`|Enfin, les prix et les modalités de paiement sont expliqués.|

L'élément crucial de cette réunion est la présentation détaillée du test d'intrusion à notre client, ainsi que de ses objectifs. Comme nous le savons déjà, chaque infrastructure est généralement unique et chaque client a des préférences particulières. Identifier ces priorités est donc essentiel lors de cette réunion.

On peut comparer cela à une commande au restaurant. Si l'on souhaite un steak saignant et que le chef nous sert un steak bien cuit, car il estime que c'est meilleur ainsi, nous serons déçus. Il est donc essentiel de respecter les souhaits du client et de servir le steak tel qu'il l'a commandé.

D'après `Contract Checklist`et les informations d'entrée partagées lors de la définition du périmètre, le `Penetration Testing Proposal`( `Contract`) et les éléments associés `Rules of Engagement`( `RoE`) sont créées.

#### [Règles d'engagement - Liste de contrôle](https://academy.hackthebox.com/beta/module/90/section/937#rules-of-engagement-checklist)

|**Point de contrôle**|**Contenu**|
|---|---|
|`☐ Introduction`|Description de ce document.|
|`☐ Contractor`|Nom de l'entreprise, nom complet du contractant, intitulé du poste.|
|`☐ Penetration Testers`|Nom de l'entreprise, nom complet du testeur d'intrusion.|
|`☐ Contact Information`|Adresses postales, adresses électroniques et numéros de téléphone de tous les clients et des testeurs d'intrusion.|
|`☐ Purpose`|Description de l'objectif du test d'intrusion réalisé.|
|`☐ Goals`|Description des objectifs à atteindre lors du test d'intrusion.|
|`☐ Scope`|Toutes les adresses IP, noms de domaine, URL ou plages CIDR.|
|`☐ Lines of Communication`|Conférences en ligne, appels téléphoniques, réunions en face à face ou par courriel.|
|`☐ Time Estimation`|Dates de début et de fin.|
|`☐ Time of the Day to Test`|Moments de la journée pour effectuer le test.|
|`☐ Penetration Testing Type`|Tests d'intrusion externes/internes/Évaluations de vulnérabilité/Ingénierie sociale.|
|`☐ Penetration Testing Locations`|Description de la procédure d'établissement de la connexion au réseau client.|
|`☐ Methodologies`|OSSTMM, PTES, OWASP et autres.|
|`☐ Objectives / Flags`|Utilisateurs, fichiers spécifiques, informations spécifiques, et autres.|
|`☐ Evidence Handling`|Chiffrement, protocoles sécurisés|
|`☐ System Backups`|Fichiers de configuration, bases de données, et autres.|
|`☐ Information Handling`|Chiffrement robuste des données|
|`☐ Incident Handling and Reporting`|Cas nécessitant un contact, interruptions lors de tests d'intrusion, types de rapports|
|`☐ Status Meetings`|Fréquence des réunions, dates, heures, parties prenantes|
|`☐ Reporting`|Type, lecteurs cibles, focus|
|`☐ Retesting`|dates de début et de fin|
|`☐ Disclaimers and Limitation of Liability`|Dommages au système, perte de données|
|`☐ Permission to Test`|Contrat signé, accord d'entrepreneur|

---

## [Réunion de lancement](https://academy.hackthebox.com/beta/module/90/section/937#kick-off-meeting)

Le `kick-off meeting`La réunion a généralement lieu à une date et une heure fixées, en présentiel, après la signature de tous les documents contractuels. Elle réunit généralement le ou les interlocuteurs du client (audit interne, sécurité de l'information, informatique, gouvernance et gestion des risques, etc., selon le client), son équipe de support technique (développeurs, administrateurs système, ingénieurs réseau, etc.) et l'équipe de test d'intrusion (un responsable, comme le chef de projet, le ou les testeurs d'intrusion, et parfois un chef de projet ou le responsable commercial). Nous détaillerons la nature du test d'intrusion et son déroulement. En général, aucun test de déni de service (DoS) n'est effectué. Nous expliquerons également qu'en cas d'identification d'une vulnérabilité critique, les activités de test d'intrusion seront suspendues, un rapport de notification de vulnérabilité sera généré et les contacts d'urgence seront contactés. Ces rapports sont généralement générés uniquement lors de tests d'intrusion externes pour des failles critiques telles que l'exécution de code à distance non authentifiée (RCE), l'injection SQL ou toute autre faille entraînant la divulgation de données sensibles. Cette notification a pour but de permettre au client d'évaluer le risque en interne et de déterminer si le problème justifie une intervention d'urgence. Nous n'interrompons généralement un test d'intrusion interne et n'alertons le client que si un système devient inaccessible, si nous décelons des activités illégales (comme du contenu illégal sur un partage de fichiers), la présence d'un acteur malveillant externe sur le réseau ou une intrusion antérieure.

Nous devons également informer nos clients des risques potentiels liés à un test d'intrusion. Par exemple, nous devons mentionner qu'un test d'intrusion peut laisser de nombreuses traces. `log entries and alarms`dans leurs applications de sécurité. De plus, si une attaque par force brute ou une attaque similaire est utilisée, il convient également de mentionner que nous pourrions accidentellement `lock some users`découvert lors du test d'intrusion. Nous devons également informer nos clients qu'ils doivent nous contacter immédiatement si le test d'intrusion effectué `negatively impacts their network`.

Expliquer le processus de test d'intrusion permet à tous les participants de bien comprendre notre démarche. Cela démontre notre professionnalisme et convainc nos interlocuteurs de notre expertise. En effet, hormis pour les équipes techniques, le directeur technique et le responsable de la sécurité des systèmes d'information, cela peut paraître complexe et difficilement compréhensible pour les non-initiés. Il est donc essentiel de bien s'adresser à son public et de cibler les personnes les moins expérimentées techniquement afin que notre approche soit accessible à tous.

Tous les points relatifs aux tests doivent être abordés et clarifiés. Il est essentiel de répondre précisément aux souhaits et aux attentes du client. Chaque entreprise, avec sa structure et son réseau spécifiques, requiert une approche adaptée. Chaque client ayant des objectifs différents, nos tests doivent être ajustés en conséquence. En général, nous pouvons évaluer l'expérience de nos clients en matière de tests d'intrusion dès les premières minutes de l'appel. Il se peut donc que nous devions approfondir certains points et nous préparer à répondre à davantage de questions, ou que l'appel de lancement soit très rapide et direct.

---

## [Contrat d'entrepreneur](https://academy.hackthebox.com/beta/module/90/section/937#contractors-agreement)

Si le test d'intrusion inclut également des tests physiques, un accord supplémentaire avec le prestataire est nécessaire. Puisqu'il s'agit non seulement d'une intrusion virtuelle, mais aussi physique, des lois totalement différentes s'appliquent. Il est également possible que de nombreux employés n'aient pas été informés du test. Imaginons que nous rencontrions des employés très sensibilisés à la sécurité lors de l'attaque physique et des tentatives d'ingénierie sociale, et que nous soyons pris sur le fait. Dans ce cas, les employés contacteront, dans la plupart des cas, la police. Cet accord supplémentaire `contractor's agreement`est notre " `get out of jail free card`" dans ce cas.

#### [Contrat d'entrepreneur - Liste de contrôle pour les évaluations physiques](https://academy.hackthebox.com/beta/module/90/section/937#contractors-agreement-checklist-for-physical-assessments)

|**Point de contrôle**|
|---|
|`☐ Introduction`|
|`☐ Contractor`|
|`☐ Purpose`|
|`☐ Goal`|
|`☐ Penetration Testers`|
|`☐ Contact Information`|
|`☐ Physical Addresses`|
|`☐ Building Name`|
|`☐ Floors`|
|`☐ Physical Room Identifications`|
|`☐ Physical Components`|
|`☐ Timeline`|
|`☐ Notarization`|
|`☐ Permission to Test`|

---

## [Configuration](https://academy.hackthebox.com/beta/module/90/section/937#setting-up)

Une fois tous les points précédents traités et les informations nécessaires recueillies, nous planifions notre approche et préparons tout. Même si les résultats du test d'intrusion restent inconnus, nous pouvons préparer nos machines virtuelles, nos serveurs privés virtuels et nos autres outils/systèmes pour tous les scénarios et situations. Vous trouverez plus d'informations et la procédure de préparation de ces systèmes dans le [module « Configuration »](https://academy.hackthebox.com/module/details/87) .



# Analyse des données

Toute analyse peut s'avérer très complexe, car de nombreux facteurs et leurs interdépendances jouent un rôle important. Outre le fait que nous travaillons avec les trois temporalités (passé, présent et futur) lors de chaque analyse, l'origine et la destination sont également des éléments essentiels. Il existe quatre types d'analyse :

|**Type d'analyse**|**Description**|
|---|---|
|`Descriptive`|L'analyse descriptive est essentielle à toute analyse de données. D'une part, elle décrit un ensemble de données en fonction de ses caractéristiques individuelles. D'autre part, elle permet de détecter d'éventuelles erreurs de collecte de données ou des valeurs aberrantes.|
|`Diagnostic`|L'analyse diagnostique clarifie les causes, les effets et les interactions des affections. Ce faisant, elle permet d'obtenir des informations précieuses grâce aux corrélations et à l'interprétation. Nous devons adopter une perspective rétrospective, semblable à celle de l'analyse descriptive, à la différence près que nous cherchons à comprendre les raisons des événements et des évolutions.|
|`Predictive`|En évaluant les données historiques et actuelles, l'analyse prédictive crée un modèle prédictif des probabilités futures. Fondée sur les résultats d'analyses descriptives et diagnostiques, cette méthode d'analyse de données permet d'identifier les tendances, de détecter précocement les écarts par rapport aux valeurs attendues et de prédire les événements futurs avec la plus grande précision possible.|
|`Prescriptive`|L'analyse prescriptive vise à déterminer les actions à entreprendre pour éliminer ou prévenir un problème futur, ou pour déclencher une activité ou un processus spécifique.|

Nous utilisons les résultats et les informations obtenus jusqu'à présent et les analysons afin d'en tirer des conclusions. Ces conclusions peuvent être étendues considérablement, mais nous devons ensuite les confirmer ou les infirmer. Supposons que nous ayons trouvé un port TCP ouvert (2121) sur un hôte lors de la phase de collecte d'informations.

Hormis le fait que ce port est ouvert, Nmap ne nous a rien révélé d'autre. Il nous faut maintenant nous interroger sur les conclusions que l'on peut tirer de ce résultat. Par conséquent, peu importe la question de départ pour parvenir à nos conclusions. L'essentiel est de se la poser. `precise questions`et souvenez-vous de ce que nous `know` et `do not know`À ce stade, nous devons d'abord nous demander ce que nous `see`et ce que nous avons réellement `have`car ce que nous voyons n'est pas la même chose que ce que nous avons :

- un `TCP` port `2121`. - `TCP`déjà signifie que ce service est `connection-oriented`.
- Est-ce un `standard` port? - `No`, car ceux-ci se situent entre `0-1023`, également appelés ports connus ou [ports système](https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)
- Y a-t-il des chiffres dans ceci ? `port number`ce regard `familiar`? - `Yes`, `TCP` port `21`( `FTP`D'après notre expérience, nous allons découvrir de nombreux ports standard et leurs services, que les administrateurs tentent souvent de dissimuler, mais pour lesquels ils utilisent fréquemment des alternatives « faciles à retenir ».

D'après nos suppositions, nous pouvons essayer de nous connecter au service en utilisant `Netcat`ou un `FTP`client et tenter d'établir une connexion pour confirmer ou infirmer notre hypothèse.

Lors de la connexion au service, nous avons constaté que la connexion était plus longue que d'habitude (environ 15 secondes). Certains services permettent de configurer la vitesse de connexion, ou le temps de réponse. Sachant désormais qu'un serveur FTP est actif sur ce port, nous pouvons déduire l'origine de notre analyse infructueuse. Nous pourrions le confirmer en spécifiant le minimum. `probe round trip time`( `--min-rtt-timeout`) dans Nmap à 15 ou 20 secondes et relancer l'analyse.

---

## [Recherche et analyse des vulnérabilités](https://academy.hackthebox.com/beta/module/90/section/939#vulnerability-research-and-analysis)

`Information Gathering` et `Vulnerability Research`peut être considérée comme une partie de l'analyse descriptive. C'est à ce stade que nous identifions les composants individuels du réseau ou du système que nous étudions. `Vulnerability Research`Nous recherchons les vulnérabilités, les exploits et les failles de sécurité connus qui ont déjà été découverts et signalés. Par conséquent, si nous avons identifié une version d'un service ou d'une application grâce à la collecte d'informations et y avons trouvé une [vulnérabilité commune (CVE)](https://www.cve.org/ResourcesSupport/FAQs) , il est très probable que cette vulnérabilité soit toujours présente.

Nous pouvons trouver des informations sur les vulnérabilités de chaque composant à partir de nombreuses sources différentes. Celles-ci incluent, sans s'y limiter :

||||
|---|---|---|
|[Détails du CVE](https://www.cvedetails.com/)|[Exploiter la base de données](https://www.exploit-db.com)|[personnes vulnérables](https://vulners.com)|
|[Sécurité des tempêtes de paquets](https://packetstormsecurity.com)|[NIST](https://nvd.nist.gov/vuln/search?execution=e2s1)||

C'est ici que `Diagnostic Analysis` et `Predictive Analysis`est utilisé. Une fois que nous avons trouvé une vulnérabilité publiée comme celle-ci, nous pouvons la diagnostiquer pour déterminer ce qui la provoque ou a provoqué cette vulnérabilité. Ici, nous devons comprendre le fonctionnement de `Proof-Of-Concept`( `POC`Nous allons reproduire au mieux le code, l'application ou le service lui-même, car de nombreuses configurations manuelles effectuées par les administrateurs nécessiteront une personnalisation pour la preuve de concept (POC). Chaque POC est conçu sur mesure pour un cas spécifique que nous devrons également adapter au nôtre dans la plupart des cas.

---

## [Évaluation des vecteurs d'attaque possibles](https://academy.hackthebox.com/beta/module/90/section/939#assessment-of-possible-attack-vectors)

`Vulnerability Assessment`comprend également les tests proprement dits, qui font partie de `Predictive Analysis`Pour ce faire, nous analysons les données historiques et les combinons aux informations actuelles que nous avons pu recueillir. Que nous ayons reçu ou non des exigences spécifiques de notre client en matière de sécurité, nous testons les services et applications identifiés. `locally` ou `on the target system`Si nous devons effectuer des tests furtivement et éviter les alertes, nous devons reproduire le système cible localement avec la plus grande précision possible. Cela signifie que nous utilisons les informations recueillies lors de la phase de collecte pour répliquer le système cible, puis que nous recherchons les vulnérabilités dans le système déployé localement.

---

## [Le retour](https://academy.hackthebox.com/beta/module/90/section/939#the-return)

Supposons que notre analyse ne nous permette pas de détecter ou d'identifier d'éventuelles vulnérabilités. Dans ce cas, nous reviendrons à la suite. `Information Gathering`étape et rechercher des informations plus approfondies que celles que nous avons recueillies jusqu'à présent. Il est important de noter que ces deux étapes ( `Information Gathering` et `Vulnerability Assessment`Les deux machines se chevauchent souvent, ce qui entraîne des allers-retours réguliers entre elles. On observe ce phénomène dans de nombreuses vidéos où l'auteur résout une HTB box ou un défi CTF. Il est important de rappeler que ces défis sont souvent résolus le plus rapidement possible, la vitesse primant donc sur la qualité. Dans un CTF, l'objectif est d'accéder à la machine cible et `capture the flags`avec les privilèges les plus élevés le plus rapidement possible au lieu d'exposer toutes les faiblesses potentielles du système.

|**`A (real) Penetration Test is not a CTF.`**|
|---|

Ici le `quality` et `intensity`Notre test d'intrusion et son analyse sont prioritaires car rien n'est pire que le piratage réussi de notre client via un vecteur relativement simple que nous aurions dû découvrir lors de notre test d'intrusion.


# Exploitation

---

Pendant le `Exploitation`À ce stade, nous recherchons des moyens d'adapter ces faiblesses à notre cas d'utilisation afin d'obtenir le rôle souhaité (par exemple, un point d'entrée, une élévation de privilèges, etc.). Si nous voulons obtenir un shell inversé, nous devons modifier la preuve de concept pour exécuter le code, de sorte que le système cible se connecte à nous via (idéalement) une connexion chiffrée à une adresse IP que nous spécifions. Par conséquent, la préparation d'un exploit fait principalement partie de… `Exploitation` scène.

![Processus de test d'intrusion : Pré-engagement, Collecte d'informations, Évaluation des vulnérabilités, Exploitation, Post-exploitation, Mouvement latéral, Preuve de concept, Post-engagement.](https://academy.hackthebox.com/storage/modules/90/0-PT-Process-EX.png)

Ces étapes ne doivent pas être strictement cloisonnées, car elles sont étroitement liées. Il est néanmoins important de bien distinguer la phase en cours et son objectif. En effet, par la suite, avec des processus beaucoup plus complexes et un volume d'informations bien plus important, il est très facile de perdre le fil des étapes franchies, surtout si le test d'intrusion dure plusieurs semaines et couvre un vaste périmètre.

---

## [Priorisation des attaques possibles](https://academy.hackthebox.com/beta/module/90/section/940#prioritization-of-possible-attacks)

Une fois que nous aurons trouvé une ou deux vulnérabilités au cours de `Vulnerability Assessment`Pour déterminer l'étape applicable à notre réseau/système cible, nous pouvons prioriser ces attaques. Le choix de la priorité dépend des facteurs suivants :

- Probabilité de succès
- Complexité
- Probabilité de dommages

Premièrement, nous devons évaluer `probability of successfully`L'exécution d'une attaque spécifique contre la cible [. Le score CVSS](https://nvd.nist.gov/vuln-metrics/cvss) peut s'avérer complexe [, grâce au calculateur NVD,](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator) permet d'évaluer plus précisément les attaques et leurs probabilités de succès.

`Complexity`Cela représente l'effort nécessaire pour exploiter une vulnérabilité spécifique. Ce chiffre sert à estimer le temps, les efforts et les recherches requis pour mener à bien l'attaque sur le système. Notre expérience est ici primordiale, car toute attaque inédite exigera logiquement davantage de recherches et d'efforts, puisqu'il est indispensable de comprendre en détail l'attaque et la structure de l'exploit avant de l'appliquer.

Estimation de `probability of damage`Les conséquences d'une exploitation de faille sont cruciales, car nous devons éviter tout dommage aux systèmes cibles. En règle générale, nous n'effectuons pas d'attaques par déni de service (DoS) sauf si notre client l'exige. Néanmoins, attaquer des services en production avec des exploits susceptibles d'endommager le logiciel ou le système d'exploitation est une pratique à proscrire absolument.

De plus, nous pouvons attribuer ces facteurs à un système de points personnel qui permettra de calculer l'évaluation avec plus de précision en fonction de nos compétences et de nos connaissances :

#### [Exemple de priorisation](https://academy.hackthebox.com/beta/module/90/section/940#prioritization-example)

|**Facteur**|**Points**|**Inclusion de fichiers distants**|**Dépassement de tampon**|
|---|---|---|---|
|1. Probabilité de succès|`10`|10|8|
|2. Complexité - Facile|`5`|4|0|
|3. Complexité - Moyenne|`3`|0|3|
|4. Complexité - Difficile|`1`|0|0|
|5. Probabilité de dommages|`-5`|0|-5|
|**Résumé**|`max. 15`|14|6|

D’après l’exemple ci-dessus, nous préférerions… `remote file inclusion`L'attaque est facile à préparer et à exécuter, et ne devrait causer aucun dommage si elle est menée avec précaution.

---

## [Préparation de l'attaque](https://academy.hackthebox.com/beta/module/90/section/940#preparation-for-the-attack)

Il arrive parfois que nous ne trouvions pas de code d'exploitation PoC fonctionnel et de haute qualité. Dans ce cas, il peut être nécessaire de reconstruire l'exploit localement sur une machine virtuelle (VM) représentant notre hôte cible afin de déterminer précisément les éléments à adapter et à modifier. Une fois le système configuré localement et les composants connus installés pour reproduire au mieux l'environnement cible (par exemple, les mêmes numéros de version pour les services et applications cibles), nous pouvons commencer la préparation de l'exploit en suivant les étapes décrites. Nous le testons ensuite sur une VM hébergée localement pour nous assurer de son bon fonctionnement et de l'absence de dommages importants. Dans d'autres situations, nous rencontrons des erreurs de configuration et des vulnérabilités fréquentes, et nous savons exactement quel outil ou exploit utiliser, ainsi que sa sécurité et son potentiel d'instabilité.

En cas de doute avant de lancer une attaque, il est toujours préférable de consulter notre client et de lui fournir toutes les données nécessaires afin qu'il puisse décider en toute connaissance de cause s'il souhaite que nous tentions une exploitation ou si nous nous contentions de signaler le problème. S'il choisit de ne pas procéder à l'exploitation, nous pouvons indiquer dans le rapport que le problème n'a pas été confirmé activement, mais qu'il s'agit probablement d'un problème à résoudre. Nous disposons d'une certaine marge de manœuvre lors des tests d'intrusion et devons toujours faire preuve de discernement si une attaque particulière semble trop risquée ou susceptible de provoquer une interruption de service. En cas de doute, communiquez. Votre responsable d'équipe/gestionnaire, le client, préférera certainement une communication plus approfondie plutôt que de se retrouver dans une situation où il tente de remettre un système en ligne après une tentative d'exploitation infructueuse.

Une fois que nous aurons exploité avec succès une cible et obtenu un accès initial (après avoir pris des notes claires pour nos rapports et consigné toutes les activités dans notre journal d'activité !), nous passerons aux phases de post-exploitation et de déplacement latéral.

